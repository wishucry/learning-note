# 论文阅读：《SGUARD - Smart Contracts Made Vulnerability-Free》与《SMARTSHIELD Automatic Smart Contract Protection Made Easy》## 总述
这两篇论文都属于智能合约漏洞修补方向的优秀会议论文，接下来仔细跟读两篇论文的内容，并且总结两者的区别跟贡献。
## SGUARD - Smart Contracts Made Vulnerability-Free （SP'21）
1. SGUARD针对的是智能合约中的4类漏洞——函数内和跨函数的重入漏洞，危险的tx.origin，算术溢出。
2. 工作流程：首先通过符号执行收集智能合约的执行流以及分析和挖掘漏洞（本文的符号执行引擎是作者从头实现的）。其次根据漏洞模型选用不同的修补方案进行修改。
3. 使用Nodejs编写，github/reentrancy/sGuard，大概三千多行
4. 该方法实现了控制流依赖分析和数据流依赖分析，用于追踪关键指令（call、delegatecall）与指令（add，sstore等）的依赖关系。
5. 面向合约源码，输出source map、bytecode以及AST
6. 在5000个合约上（最后实际上是1605个合约）进行了测试，时间（14.79%）和gas（0.79%）开销表现很好。
7. 最后人工检查，对top10的ERC20进行了人工检查，修补后没有漏洞，gas开销约为18%。


## SMARTSHIELD Automatic Smart Contract Protection Made Easy （SANER'20）
1. SMARTSHIELD针对的智能合约中的三类漏洞——重入，算术溢出，未检查调用返回值漏洞。
2. 本文从以太坊主网2,214,409个智能合约收集了95502个不安全的案例。实验数据集包含95502个不安全的案例，91.5%被SMARTSHIELD修复，每个合约只增加了0.2%的gas开销。
3. SMARTSHIELD对合约进行字节码级别的程序分析，利用语义保护转换技术进行了整改，设置了gas优化策略，保证整改后的gas消耗尽量小。
4. SMARTSHIELD依然针对的是智能合约源码。工作流程如下：
    ![](media/16544096654751/16544118485762.jpg)
5. SMARTSHIELD针对三类漏洞的修补手段主要有两种：针对重入漏洞的控制流转换，针对算术溢出和返回值的检查缺失问题，使用插入DataGuard的方法进行整改。